<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produktionsauslastung Graphen</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background-color: #f5f5f5;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <canvas id="overviewChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="dailyChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="weeklyChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="personnelChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="utilizationChart"></canvas>
    </div>

    <script>
        window.addEventListener('load', function() {
            const productionData = {
                'KW28': {
                    'Mo': { hohl2: 13.2, hohl3: 25.2, hohl4: 30.7, massiv2: 38.4, massiv3: 84.2 },
                    'Di': { hohl2: 79.2, hohl3: 51.5, hohl4: 23.6, massiv2: 30.8, massiv3: 117.2 },
                    'Mi': { hohl2: 15.0, hohl3: 74.7, hohl4: 0, massiv2: 27.8, massiv3: 52.3 },
                    'Do': { hohl2: 0, hohl3: 0, hohl4: 0, massiv2: 0, massiv3: 66.5 },
                    'Fr': { hohl2: 0, hohl3: 0, hohl4: 0, massiv2: 0, massiv3: 0 }
                },
                'KW29': {
                    'Mo': { hohl2: 24.7, hohl3: 34.1, hohl4: 43.5, massiv2: 40.8, massiv3: 0 },
                    'Di': { hohl2: 40.2, hohl3: 90.7, hohl4: 26.5, massiv2: 38.8, massiv3: 0 },
                    'Mi': { hohl2: 37.3, hohl3: 67.2, hohl4: 35.0, massiv2: 48.9, massiv3: 0 },
                    'Do': { hohl2: 32.4, hohl3: 48.0, hohl4: 35.5, massiv2: 17.0, massiv3: 0 },
                    'Fr': { hohl2: 43.8, hohl3: 0, hohl4: 42.5, massiv2: 0, massiv3: 0 }
                },
                'KW30': {
                    'Mo': { hohl2: 32.1, hohl3: 58.2, hohl4: 0, massiv2: 41.7, massiv3: 0 },
                    'Di': { hohl2: 23.9, hohl3: 62.2, hohl4: 28.0, massiv2: 36.8, massiv3: 115.6 },
                    'Mi': { hohl2: 42.6, hohl3: 57.1, hohl4: 0, massiv2: 37.7, massiv3: 89.5 },
                    'Do': { hohl2: 61.4, hohl3: 41.6, hohl4: 0, massiv2: 0, massiv3: 52.4 },
                    'Fr': { hohl2: 2.6, hohl3: 0, hohl4: 0, massiv2: 0, massiv3: 0 }
                },
                'KW31': {
                    'Mo': { hohl2: 0, hohl3: 56.5, hohl4: 0, massiv2: 38.9, massiv3: 102.2 },
                    'Di': { hohl2: 0, hohl3: 83.3, hohl4: 3.2, massiv2: 40.8, massiv3: 88.1 },
                    'Mi': { hohl2: 0, hohl3: 44.6, hohl4: 1.6, massiv2: 44.8, massiv3: 18.6 },
                    'Do': { hohl2: 0, hohl3: 0, hohl4: 0, massiv2: 35.9, massiv3: 0 },
                    'Fr': { hohl2: 0, hohl3: 0, hohl4: 0, massiv2: 0, massiv3: 0 }
                },
                'KW32': {
                    'Mo': { hohl2: 52.5, hohl3: 54.0, hohl4: 54.4, massiv2: 41.0, massiv3: 103.7 },
                    'Di': { hohl2: 67.8, hohl3: 102.7, hohl4: 38.9, massiv2: 42.0, massiv3: 104.3 },
                    'Mi': { hohl2: 66.8, hohl3: 62.9, hohl4: 52.8, massiv2: 37.3, massiv3: 53.1 },
                    'Do': { hohl2: 0, hohl3: 51.8, hohl4: 26.9, massiv2: 41.2, massiv3: 0 },
                    'Fr': { hohl2: 0, hohl3: 0, hohl4: 0, massiv2: 28.5, massiv3: 0 }
                },
                'KW33': {
                    'Mo': { hohl2: 41.4, hohl3: 83.6, hohl4: 38.2, massiv2: 39.5, massiv3: 102.2 },
                    'Di': { hohl2: 32.2, hohl3: 86.6, hohl4: 34.9, massiv2: 42.2, massiv3: 99.3 },
                    'Mi': { hohl2: 31.7, hohl3: 87.1, hohl4: 0, massiv2: 39.7, massiv3: 94.5 },
                    'Do': { hohl2: 62.9, hohl3: 80.0, hohl4: 0, massiv2: 44.8, massiv3: 26.7 },
                    'Fr': { hohl2: 26.3, hohl3: 0, hohl4: 0, massiv2: 5.7, massiv3: 0 }
                },
                'KW34': {
                    'Mo': { hohl2: 68.0, hohl3: 86.4, hohl4: 51.6, massiv2: 40.3, massiv3: 104.4 },
                    'Di': { hohl2: 65.1, hohl3: 74.3, hohl4: 51.8, massiv2: 41.9, massiv3: 102.2 },
                    'Mi': { hohl2: 78.7, hohl3: 98.8, hohl4: 51.5, massiv2: 34.7, massiv3: 100.1 },
                    'Do': { hohl2: 9.2, hohl3: 84.5, hohl4: 0, massiv2: 44.8, massiv3: 85.3 },
                    'Fr': { hohl2: 0, hohl3: 14.8, hohl4: 0, massiv2: 31.9, massiv3: 49.9 }
                },
                'KW35': {
                    'Mo': { hohl2: 40.2, hohl3: 79.2, hohl4: 0, massiv2: 41.4, massiv3: 104.5 },
                    'Di': { hohl2: 39.2, hohl3: 96.7, hohl4: 0, massiv2: 39.1, massiv3: 98.8 },
                    'Mi': { hohl2: 26.1, hohl3: 84.4, hohl4: 0, massiv2: 43.2, massiv3: 99.8 },
                    'Do': { hohl2: 46.4, hohl3: 93.8, hohl4: 0, massiv2: 36.5, massiv3: 66.2 },
                    'Fr': { hohl2: 1.0, hohl3: 0, hohl4: 0, massiv2: 48.5, massiv3: 0 }
                }
            };

            Chart.defaults.font.family = 'Arial, sans-serif';
            
            const colors = {
                hohl2: 'rgba(54, 162, 235, 0.8)',
                hohl3: 'rgba(255, 99, 132, 0.8)',
                hohl4: 'rgba(255, 206, 86, 0.8)',
                massiv2: 'rgba(75, 192, 192, 0.8)',
                massiv3: 'rgba(153, 102, 255, 0.8)'
            };

            // Chart 1: Durchschnittliche Gesamtproduktion pro Wochentag
            const overviewCtx = document.getElementById('overviewChart').getContext('2d');
            const weekdays = ['Mo', 'Di', 'Mi', 'Do', 'Fr'];
            const avgByDay = { Mo: [], Di: [], Mi: [], Do: [], Fr: [] };
            
            Object.values(productionData).forEach(week => {
                weekdays.forEach(day => {
                    const total = week[day].hohl2 + week[day].hohl3 + week[day].hohl4 + 
                                week[day].massiv2 + week[day].massiv3;
                    avgByDay[day].push(total);
                });
            });
            
            const avgTotals = weekdays.map(day => 
                avgByDay[day].reduce((a, b) => a + b, 0) / avgByDay[day].length
            );

            new Chart(overviewCtx, {
                type: 'bar',
                data: {
                    labels: weekdays,
                    datasets: [{
                        label: 'Durchschnittliche Gesamtproduktion pro Wochentag',
                        data: avgTotals,
                        backgroundColor: 'rgba(75, 192, 192, 0.8)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Produktionsstunden (alle 5 Anlagen)'
                            }
                        }
                    }
                }
            });

            // Chart 2: Tägliche Auslastung
            const dailyCtx = document.getElementById('dailyChart').getContext('2d');
            const labels = [];
            const datasets = [];
            
            ['hohl2', 'hohl3', 'hohl4', 'massiv2', 'massiv3'].forEach(anlage => {
                const data = [];
                Object.keys(productionData).forEach(week => {
                    weekdays.forEach(day => {
                        if (anlage === 'hohl2') labels.push(`${week}-${day}`);
                        data.push(productionData[week][day][anlage]);
                    });
                });
                
                datasets.push({
                    label: anlage.charAt(0).toUpperCase() + anlage.slice(1).replace('2', ' 2').replace('3', ' 3').replace('4', ' 4'),
                    data: data,
                    backgroundColor: colors[anlage],
                    stack: 'Stack 0'
                });
            });

            new Chart(dailyCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Produktionsstunden'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tägliche Auslastung aller 5 Anlagen'
                        },
                        tooltip: {
                            callbacks: {
                                afterTitle: function(context) {
                                    let sum = 0;
                                    context.forEach(function(tooltipItem) {
                                        sum += tooltipItem.parsed.y;
                                    });
                                    return 'Gesamt: ' + sum.toFixed(1) + ' Stunden';
                                }
                            }
                        }
                    }
                }
            });

            // Chart 3: Wöchentliche Auslastung
            const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');
            const weeklyLabels = Object.keys(productionData);
            const weeklyDatasets = [];
            
            ['hohl2', 'hohl3', 'hohl4', 'massiv2', 'massiv3'].forEach(anlage => {
                const weeklyData = [];
                weeklyLabels.forEach(week => {
                    let sum = 0;
                    Object.values(productionData[week]).forEach(day => {
                        sum += day[anlage];
                    });
                    weeklyData.push(sum);
                });
                
                weeklyDatasets.push({
                    label: anlage.charAt(0).toUpperCase() + anlage.slice(1).replace('2', ' 2').replace('3', ' 3').replace('4', ' 4'),
                    data: weeklyData,
                    borderColor: colors[anlage],
                    backgroundColor: colors[anlage].replace('0.8', '0.2'),
                    tension: 0.1
                });
            });

            const totalWeekly = weeklyLabels.map((week, idx) => {
                let sum = 0;
                weeklyDatasets.forEach(dataset => {
                    sum += dataset.data[idx];
                });
                return sum;
            });

            weeklyDatasets.push({
                label: 'Gesamt',
                data: totalWeekly,
                borderColor: 'rgba(0, 0, 0, 1)',
                backgroundColor: 'rgba(0, 0, 0, 0.1)',
                borderWidth: 3,
                tension: 0.1,
                borderDash: [5, 5]
            });

            new Chart(weeklyCtx, {
                type: 'line',
                data: {
                    labels: weeklyLabels,
                    datasets: weeklyDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Produktionsstunden pro Woche'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Wöchentliche Gesamtauslastung'
                        }
                    }
                }
            });

            // Chart 4: Personalbelastung
            const personnelCtx = document.getElementById('personnelChart').getContext('2d');
            const maxLoad = [];
            const minLoad = [];
            const avgLoad = [];
            const activeLines = [];

            weekdays.forEach(day => {
                let dayLoads = [];
                let activeCounts = [];
                Object.values(productionData).forEach(week => {
                    const total = week[day].hohl2 + week[day].hohl3 + week[day].hohl4 + 
                               week[day].massiv2 + week[day].massiv3;
                    dayLoads.push(total);
                    
                    let active = 0;
                    if (week[day].hohl2 > 0) active++;
                    if (week[day].hohl3 > 0) active++;
                    if (week[day].hohl4 > 0) active++;
                    if (week[day].massiv2 > 0) active++;
                    if (week[day].massiv3 > 0) active++;
                    activeCounts.push(active);
                });
                maxLoad.push(Math.max(...dayLoads));
                minLoad.push(Math.min(...dayLoads));
                avgLoad.push(dayLoads.reduce((a, b) => a + b, 0) / dayLoads.length);
                activeLines.push(activeCounts.reduce((a, b) => a + b, 0) / activeCounts.length);
            });

            new Chart(personnelCtx, {
                type: 'line',
                data: {
                    labels: weekdays,
                    datasets: [{
                        label: 'Maximale Tagesbelastung',
                        data: maxLoad,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        yAxisID: 'y'
                    }, {
                        label: 'Durchschnitt',
                        data: avgLoad,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.3)',
                        borderWidth: 3,
                        tension: 0.3,
                        yAxisID: 'y'
                    }, {
                        label: 'Minimale Tagesbelastung',
                        data: minLoad,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        yAxisID: 'y'
                    }, {
                        label: 'Ø Aktive Anlagen',
                        data: activeLines,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        borderDash: [5, 5],
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Gesamtstunden (alle Anlagen)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 5,
                            title: {
                                display: true,
                                text: 'Anzahl aktive Anlagen'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Personalbelastung nach Wochentag'
                        }
                    }
                }
            });

            // Chart 5: Anlagenauslastung
            const utilizationCtx = document.getElementById('utilizationChart').getContext('2d');
            const anlagen = ['hohl2', 'hohl3', 'hohl4', 'massiv2', 'massiv3'];
            const totalHoursByAnlage = [];
            const activeDaysByAnlage = [];

            anlagen.forEach(anlage => {
                let totalHours = 0;
                let activeDays = 0;
                
                Object.values(productionData).forEach(week => {
                    Object.values(week).forEach(day => {
                        totalHours += day[anlage];
                        if (day[anlage] > 0) activeDays++;
                    });
                });
                
                totalHoursByAnlage.push(totalHours);
                activeDaysByAnlage.push(activeDays);
            });

            new Chart(utilizationCtx, {
                type: 'bar',
                data: {
                    labels: anlagen.map(a => a.charAt(0).toUpperCase() + a.slice(1).replace('2', ' 2').replace('3', ' 3').replace('4', ' 4')),
                    datasets: [{
                        label: 'Gesamtstunden',
                        data: totalHoursByAnlage,
                        backgroundColor: Object.values(colors),
                        yAxisID: 'y'
                    }, {
                        label: 'Aktive Tage',
                        data: activeDaysByAnlage,
                        type: 'line',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Gesamtproduktionsstunden'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Anzahl aktive Tage'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Auslastung pro Anlage'
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>